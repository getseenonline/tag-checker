<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tag Checker</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    background: #f6f7fb;
    color: #0E1A40;
  }
  header {
    background: #1c275e;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
  }
  header img {
    height: 40px;
  }
  .container {
    display: flex;
    padding: 20px;
    gap: 20px;
  }
  .sidebar {
    width: 280px;
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  .main {
    flex: 1;
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    overflow-x: auto;
  }
  button {
    background: #0E1A40;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 500;
  }
  button:hover {
    background: #14245a;
  }
  #manageAccounts {
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  }
  h3 {
    margin-top: 15px;
  }
  .radio-group label {
    margin-right: 8px;
  }
  input[type="radio"] {
    accent-color: #F7931F;
  }
  input[type="range"]::-webkit-slider-thumb {
    background: #F7931F;
  }
  input[type="range"]::-moz-range-thumb {
    background: #F7931F;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
  }
  .modal-content {
    background: #fff;
    margin: 80px auto;
    padding: 20px;
    border-radius: 10px;
    width: 420px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
  }
  .close {
    float: right;
    font-size: 22px;
    cursor: pointer;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
  }
  th {
    background: #f3f4f7;
    cursor: col-resize;
  }
  .bottom-space {
    height: 60px;
  }
</style>
</head>
<body>
<header>
  <h2>Tag Checker</h2>
  <a href="https://get-seenonline.com" target="_blank">
    <img src="GSO Logo.png" alt="Get Seen Online Logo">
  </a>
</header>

<div class="container">
  <div class="sidebar">
    <button id="manageAccounts">Manage Accounts</button>
    <button id="topTags">Top Tags</button>

    <h3>Primary Tags</h3>
    <div class="radio-group">
      <label><input type="radio" name="logic" value="AND" checked> AND</label>
      <label><input type="radio" name="logic" value="OR"> OR</label>
    </div>

    <h3>Secondary Tags</h3>

    <h3>Compact Mode</h3>
    <input id="compactSlider" type="range" min="0" max="1" step="1">
  </div>

  <div class="main">
    <h3>Contacts</h3>
    <table id="contactsTable">
      <thead>
        <tr><th>First Name</th><th>Last Name</th><th>Email</th><th>Tags</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="bottom-space"></div>
  </div>
</div>

<!-- Manage Accounts Modal -->
<div id="accountsModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <h3>Manage Accounts</h3>
    <label>Select account:</label>
    <select id="accountList" style="width:100%;margin-bottom:10px;"></select>
    <div>
      <button id="editAccount">Edit</button>
      <button id="deleteAccount">Delete</button>
    </div>
    <hr>
    <h4>Add New Account</h4>
    <input type="text" id="accountName" placeholder="Account name" style="width:100%;margin-bottom:5px;">
    <input type="password" id="apiKey" placeholder="API Key" style="width:100%;margin-bottom:5px;">
    <button id="saveAccount">Save Account</button>
    <hr>
    <button id="fetchContacts">Fetch from GHL</button>
  </div>
</div>

<script>
let accounts = JSON.parse(localStorage.getItem('ghlAccounts') || '[]');
let activeAccount = localStorage.getItem('activeAccount') || '';
let rows = [];

function saveAccounts() {
  localStorage.setItem('ghlAccounts', JSON.stringify(accounts));
  renderAccountList();
}

function renderAccountList() {
  const select = document.getElementById('accountList');
  select.innerHTML = accounts.map(a => 
    `<option value="${a.name}" ${a.name===activeAccount?'selected':''}>${a.name}</option>`
  ).join('');
}

document.getElementById('manageAccounts').onclick = () => {
  document.getElementById('accountsModal').style.display = 'block';
  renderAccountList();
};
document.getElementById('closeModal').onclick = () => {
  document.getElementById('accountsModal').style.display = 'none';
};

document.getElementById('saveAccount').onclick = () => {
  const name = document.getElementById('accountName').value.trim();
  const key = document.getElementById('apiKey').value.trim();
  if(!name || !key) return alert('Enter name and key');
  accounts.push({name, key});
  activeAccount = name;
  saveAccounts();
  alert('Account saved.');
};

document.getElementById('deleteAccount').onclick = () => {
  const name = document.getElementById('accountList').value;
  if(confirm('Delete this account?')) {
    accounts = accounts.filter(a => a.name !== name);
    saveAccounts();
    alert('Deleted.');
  }
};

document.getElementById('editAccount').onclick = () => {
  const name = document.getElementById('accountList').value;
  const acc = accounts.find(a=>a.name===name);
  if(!acc) return;
  document.getElementById('accountName').value = acc.name;
  document.getElementById('apiKey').value = acc.key;
  accounts = accounts.filter(a=>a.name!==name);
};

document.getElementById('fetchContacts').onclick = async () => {
  const name = document.getElementById('accountList').value;
  const acc = accounts.find(a=>a.name===name);
  if(!acc) return alert('No account selected.');
  activeAccount = name;
  localStorage.setItem('activeAccount', name);
  try {
    const response = await fetch(`https://api.gohighlevel.com/v1/contacts/`, {
      headers: { Authorization: `Bearer ${acc.key}` }
    });
    const data = await response.json();
    rows = data.contacts || [];
    renderContacts();
    alert(`Loaded ${rows.length} contacts`);
  } catch(e) {
    alert('Error fetching contacts.');
  }
};

function renderContacts() {
  const tbody = document.querySelector('#contactsTable tbody');
  tbody.innerHTML = rows.map(r=>`
    <tr>
      <td>${r.firstName||''}</td>
      <td>${r.lastName||''}</td>
      <td>${r.email||''}</td>
      <td>${(r.tags||[]).join(', ')}</td>
    </tr>
  `).join('');
}

window.onclick = (e)=>{
  if(e.target===document.getElementById('accountsModal'))
    document.getElementById('accountsModal').style.display='none';
};
</script>
</body>
</html>
